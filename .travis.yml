language: clojure

# Don't use the Travis Container-Based Infrastructure
sudo: true

addons:
    chrome: stable

script:
    - lein test

after_success:
    - lein do clean, cljsbuild once min, less once

    # compile builtin sources with planck
    - sudo add-apt-repository -y ppa:mfikes/planck
    - sudo apt-get update -q
    - sudo apt-get install -y planck

    # plk depends on clojure
    - curl -O https://download.clojure.org/install/linux-install-1.9.0.381.sh
    - chmod +x linux-install-1.9.0.381.sh
    - sudo ./linux-install-1.9.0.381.sh

    # install the plk tool
    - wget https://raw.githubusercontent.com/planck-repl/planck/8f952f8f0e14993029062a39f1a530f2c228ca77/planck-sh/plk -O plk/plk
    - chmod +x plk/plk
    - export PATH=$PATH:$PWD/plk/

    # finally, run
    - scripts/compile-builtin-sources

deploy:
    provider: pages
    skip_cleanup: true
    github_token: $GITHUB_DEPLOY # Set in travis-ci.org dashboard
    local_dir: resources/public
    on:
        branch: master


